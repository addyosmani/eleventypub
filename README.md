# eleventypub

This project uses vanilla [11ty](https://11ty.io), along with some pre and post processing, to build an EPUB fileset. Options to validate and run accessibility checks.

## Quickstart
Clone this repo and start editing:

    $ git clone https://github.com/marisademeglio/eleventypub.git
    $ cd eleventypub
    $ npm install


Go to `src/pages`. Edit the pages there or make your own, following the examples.

Go to `src/toc.md` and fill in the table of contents, following the example.

Go to `src/cover.md` and make a cover page.

In the terminal:

    $ npm run build

Your EPUB fileset is in `build/epub`.

Better: do what it says under [Configure Tools](#configure-tools) and then you can run:

    $ npm run all

To build, validate, save, and run accessibility checks. Output from all appears in `build`

## Configure Tools

- Download and unzip [EPUBCheck](https://github.com/w3c/epubcheck)
- Install [Ace by DAISY](https://daisy.github.io/ace).
- Install [npm-run-all](https://www.npmjs.com/package/npm-run-all)

## Conventions

You have as much freedom as you have with 11ty to mix and match templates and options.

This project uses the following conventions:

- `pages/`: for chapter files
  - `pages.json` contains front matter options for files in `pages/`:
    - `layout: page.njk`
    - `EPUBRoot: ../..`
    - `tags: pages`
- `toc.md`: Table of contents. Front matter options:
  - `auto: (true|false)`: autogenerate the TOC or use the content in this file
  - `layout`: layout template
  - `EPUBRoot: '..'`: relative path to the root of the EPUB
- `cover.md`: Cover file. Front matter options:
  - `layout`: layout template
  - `EPUBRoot: '..'`: relative path to the root of the EPUB
- `index.md`: This becomes the package document. It's empty except for the front matter options:
  - `layout`: layout template
- `_data`: publication data that ends up in the package document and elsewhere
  - `metadata.json`: as many `dc` terms, `properties`, and `links` as you want.
  - `pub.json`:
    - `toc`
    - `cover`
    - `readingOrder`: _(optional)_ specify the fileSlugs of the files in order. If `readingOrder` is not specified, a reading order gets generated automatically in alphabetical order.
- `resources`: Fonts, CSS, images, etc; basically, anything you want listed in the manifest and copied over.

This project does not guarantee a valid EPUB. You have to [configure EPUBCheck](#configure-epubcheck).

## Scripts
- `build`: create the EPUB fileset
- `epubcheck`: run EPUBCheck on the output
- `save`: run EPUBCheck and if valid, save an EPUB file
- `ace`: run the Ace accessibility checker. The report will be in `build/report`
- `pretty`: run an XML-prettifier on `package.opf` and all `xhtml` files.
- `all`: build, prettify, save, and run ace

## FAQ

### Can I use other formats for my templates?

Yes absolutely, you can do whatever you can do with 11ty, which is a lot. Note that this project is configured to save XHTML from Markdown files [TODO ref], and in the `postbuild` step, all `html` files are renamed to `xhtml` [TODO ref]. So, whatever you try, it's up to you to make sure that your output is valid. Be sure to [configure your tools](#configure-tools) so you can run EPUBCheck.

### What are the TOC options?

You need to have a TOC file, pointed to by `pub.json`. In this example, it's `src/toc.md`:

[TODO ref toc.md]

`auto: true` the TOC will be autogenerated. Each chapter file will get an entry with its title. I never said we were fancy.

`auto: false`: you provide everything that's going to go between `<nav>` and `</nav>` in your TOC file. It's up to you to make sure these contents are EPUB 3 compliant (e.g. valid XHTML, ordered lists).

If you're providing your own TOC, triple-check the file references to make sure the relative path is correct (use `EPUBRoot` to help). Also, make sure you point to `xhtml` files, as that's what they'll be in the end, as a result of our `postbuild` step.

## Future

There's lots of room for expansion. Some ideas could be:

- Fine tune TOC autogeneration with some options
- Have more TOC templates, for example something with a pagelist.
- Add media overlays (based on what input I'm not sure, maybe some kind of timestamp list)
- more robust build process
  - the XHTML-ification is spread out in a few different places)
  - no control over where files get output (get 11ty's default behavior is, for `chapter1.md`, to output `chapter1/index.html`)
